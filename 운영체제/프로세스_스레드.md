# 프로세스와 스레드

> 은빈

### 프로세스(Process)란

컴퓨터에서 실행되고 있는 프로그램.
여기에서 중요한 것은 '실행되고 있는'이다. Xcode는 프로그램이고, 코딩을 하기 위해 Xcode 빌드를 하고 있다면 그것은 프로세스인 것.

앞서 운영체제가 하는 여러 가지 일 중에 CPU 스케줄링이 있었다. 이는 현재 실행중인 여러 개의 프로그램이 동시에 실행되고 있는 것 처럼 보이게 열심히 프로세스를 번갈아 실행하고 관리하는 것이다.

근데 운영체제가 각각 프로세스가 뭔지 알고 CPU를 할당하지? CPU를 특정 프로세스에 할당 해 주려면 프로세스에 대한 정보가 있어야 한다. 프로세스의 현재 상태를 알기 위한 모든 요소를 `문맥(context)`이라 한다.

#### 문맥(context)
- 특정 시점에서 프로세스가 어느 정도 실행 됐고, 어떤 주소공간에 어느정도의 data를 쌓아뒀는지 등을 규명하기 위한 것.
- CPU 수행 상태를 하드웨어 문맥(Program Counter, Register)
- 프로세스 주소 공간(Code, Data, Stack)
- 프로세스 관련 커널 자료구조(PCB-Process Control Block, Kernel Stack)

CPU의 열일로 프로세스들이 번갈아 실행되기 때문에 프로세스의 현재 문맥을 알고 있지 않으면 Context Switch(CPU를 어떤 프로세스에서 다른 프로세스로 넘겨 주는 과정)가 어려움!


### 스레드(Thread)란

프로세스를 수행하는 주체. CPU의 수행 단위, 프로세스에서의 실행의 흐름 단위라고도 한다. 앞서 Xcode 빌드를 하는 것 자체를 프로세스라고 하면, UI를 표시하는 작업, 서버에서 데이터를 받아오는 작업, 코드 한 블럭 블럭을 실행하는 작업 각각이 스레드인 것.

CPU 수행 단위인 만큼 각각의 스레드는 프로그램 카운터를 가진다. 프로그램 카운터만 가지는 것이 아니라, CPU가 기억하고 있어야 하는 정보(프로그램 카운터, 레지스터)를 각각 가지고 있다. 그 외에 프로세스에 대한 정보는 공유할 수 있기 때문에 공유자원으로 사용한다.

단일 스레드도 있지만 요즘은 그런거 없다. 거의(다) 멀티 스레드 환경에서 프로세스가 실행된다고 한다. 프로세스에 많은 스레드가 있으면 좋은 점이 뭘까?

1. 경제성
    - 동일한 일을 하는 스레드들이 모여 최대의 효율을 낼 수 있다.
    - CPU가 프로세스를 바꾸는 문맥 교환보다 프로세스 내에서 스레드가 교환되는 것이 오버헤드가 적다.
    - 프로세스에 대한 정보를 공유하기 때문에 자원 공유에 있어서 경제적이다.
2. 응답성
    - 다중 스레드의 경우, 하나의 스레드가 blocked 상태일 때 다른 스레드가 running되어 높은 응답성을 보일 수 있다.
3. 병렬성
    - CPU가 두 개 이상인 경우, 스레드가 병렬적으로 일을 수행할 수 있다. 

#### 프로그램 카운터(Program Counter, PC)

CPU는 한 번에 한 동작만 하지 않는다. 프로세스를 번갈아 실행시키고 입출력에 대한 처리를 하기도 하고, 커널에 대한 수행을 하기도 한다. 여기저기 돌아다니면서 열일하는데, 이 과정에서 CPU는 어느 코드까지 실행됐는지를 기억해야 한다. 그 기억이 없으면 프로세스들에게 일감을 줄 때마다(CPU를 얻는 프로세스가 바뀔 때마다) 코드를 맨 처음부터 다시 시작해야 할 것이다. CPU가 어느 코드까지 실행됐고, 어디부터 다시 실행해야 하는지를 기억하는 것이 프로그램 카운터다.


### 프로세스 vs 스레드

프로세스... 너 안에 스레드 있다...
